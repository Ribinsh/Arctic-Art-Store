<html lang="en">
    <head >
        <title style="color: brown">Arctic</title>
        <meta name="author" content="Zaur">
        <meta descryption content="Presentation of website">
        <meta name="keywords" content="technology, cyber security, software">
        <meta http-equiv="refresh" content="100">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <meta charset="utf-8">
        <link rel="stylesheet" href="/stylesheets/home/animate.css">
	

        <link rel="stylesheet" href="/public/stylesheets/cart.css">
        <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.4.1/dist/css/bootstrap.min.css" integrity="sha384-Vkoo8x4CGsO3+Hhxv8T/Q5PaXtkKtu6ug5TOeNV6gBiFeWPGFN9MuhOf23Q9Ifjh" crossorigin="anonymous">
        <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.9.1/font/bootstrap-icons.css">
       <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.1.1/css/all.min.css">
     <link href='https://unpkg.com/boxicons@2.1.2/css/boxicons.min.css' rel='stylesheet'> 
     
     <script src="/js/home/modernizr-2.6.2.min.js"></script>
     <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.6.0/jquery.min.js"></script>
     <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.9.1/font/bootstrap-icons.css">

     </head> 
  <body> 
    
    <%- include ('nav.ejs') %>

    <div class="container px-3 my-5 clearfix">
        <!-- Shopping cart table -->
        <div class="cart card">
            <div class="card-header">
                <h2>Art cart</h2>
            </div>
            <div class="card-body">
                <div class="table-responsive">
                  <table class="table table-bordered m-0">
                    <thead>
                      <tr>
                        <!-- Set columns width -->
                        <th class="text-center py-3 px-4" style="min-width: 400px;">Product Name &amp; Details</th>
                        <th class="text-right py-3 px-4" style="width: 100px;">Price</th>
                        <th class="text-center py-3 px-4" style="width: 120px;">Quantity</th>
                        <th class="text-right py-3 px-4" style="width: 100px;">Total</th>
                        <th class="text-center align-middle py-3 px-0" style="width: 40px;"><a href="#" class="shop-tooltip float-none text-light" title="" data-original-title="Clear cart"><i class="ino ion-md-trash"></i></a></th>
                      </tr>
                    </thead>
                    <tbody>
                      <% cartProducts.forEach(function(product){ %> 
                      <tr>
                        <td class="p-4">
                          <div class="media align-items-center">
                            <img src="/<%= product.productId.imageUrl %>" class="d-block ui-w-40 ui-bordered mr-4" alt="">
                            <div class="media-body">
                              <a href="#" class="d-block text-dark" style="font-size: larger ; font-weight:bolder ;"> Product <%= index++ %></a>
                                <span  style="color:red;"><%=product.productId.productName %> </span>
                                <br> 
                                <span class=" text-large">Category:<%=product.productId.category %></span>
                               
                                
                                
                              
                            </div>
                          </div>
                        </td>
                        <td class="text-right font-weight-semibold align-middle p-4" >Rs.<%= product.productId.price %></td>

                        <td class="align-middle p-4" class="form-control text-center" >
                        
                          <button
                          class=" button-minus border rounded-circle icon-shape icon-sm cart-item-count mr-3"
                          onclick="changeQuantity('<%= cartId %>','<%= product.productId._id %>','<%= product.productId.price %>',-1)"
                          id="disable<%= product.productId._id %>" disabled="false">-</button>

                      <span id= '<%= product.productId._id %>'><%= product.quantity %></span>

                      <button
                          class="button-minus border rounded-circle icon-shape icon-sm cart-item-count mr-3"

                          onclick="changeQuantity('<%= cartId %>','<%= product.productId._id %>','<%= product.productId.price %>',1)">+</button>
                          
                        </td>
                        
                        <td class="text-right font-weight-semibold align-middle p-4" id="total<%= product.productId._id %>" >Rs.<%=  product.total %></td>
                        <td class="text-center align-middle px-0"><a href="/deleteCart/<%= product.productId._id %>" class="shop-tooltip close float-none text-danger" title="" data-original-title="Remove">Ã—</a></td>
                      </tr>
                    <% }) %>
                      
                    </tbody>
                  </table>
                </div>
                <!-- / Shopping cart table -->
            
                <div class="d-flex flex-wrap justify-content-between align-items-center pb-4">
                  <div class="mt-4">
                    <label class="text-muted font-weight-normal">Promocode</label>
                    <input type="text" placeholder="ABC" class="form-control">
                  </div>
                  <div class="d-flex">
                    <div class="text-right mt-4 mr-5">
                      <label class="text-muted font-weight-normal m-0">Discount</label>
                      <div class="text-large"><strong>Rs.0</strong></div>
                    </div>
                    <div class="text-right mt-4">
                      <label class="text-muted font-weight-normal m-0" >Total price</label>
                      <div class="text-large"><strong id="subtotal">
                       Rs.<%= list.cartTotal %>
                      </strong></div>
                    </div>
                  </div>
                </div>
            
                <div class="float-right">
                  <button type="button" class="btn btn-lg btn-default md-btn-flat mt-2 mr-3">Back to shopping</button>
                  <a href="/checkout"><button type="button" class="btn btn-lg btn-primary mt-2" >Checkout</button></a>
                </div>
            
              </div>
          </div>
      </div>
  </body>

 
 
 <script>


     function changeQuantity(cartId, productId,price,count) {
      
      let quantity = parseInt(document.getElementById(productId).innerHTML)
      count = parseInt(count)
      $.ajax({
          url: '/change-quantity',
          data: {
              // user: userId,
              cart: cartId,
              product: productId,
              count: count,
              quantity: quantity
          },
          method: 'post',
          success: (response) => {
            if (response.status== true) {
            console.log("cart updated");                
                  document.getElementById(productId).innerHTML = quantity + count         //quantity
                  j = quantity + count
                  document.getElementById('total'+productId).innerHTML = 'Rs.' + j * price //price total
                  if (j <= 1) {
                      document.getElementById("disable"+productId).disabled = true;
                  } else {
                      document.getElementById("disable"+productId).disabled = false;
                  }
              document.getElementById('subtotal').innerHTML =response.sumTotal
             
           }
          }
      })
  }

  </script>
</html>
